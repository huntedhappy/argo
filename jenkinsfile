pipeline {
    environment {
        registry = "library/my-image"
        dockerImage = ''
        // the address of your harbor registry
        REGISTRY = 'https://harbor.tkg.io'
        // the project name
        // make sure your robot account have enough access to the project
        HARBOR_PROJECTS = 'library'
        // docker image name
        APP_NAME = 'docker-example'
        // ‘robot-test’ is the credential ID you created on the KubeSphere console
        HARBOR_CREDENTIAL = credentials('dockerhub')        
    }
    agent any
    stages {
        stage('Cloning Git') {
            steps{
                checkout scm
            }
        }
        stage('Building Docker Image') {
            steps{
                script {
                    dockerImage = docker.build HARBOR_PROJECTS/HARBOR_PROJECTS + ":$BUILD_NUMBER"
                }
            }
        }
        stage("install helm in Docker"){
            steps {
                sh 'whoami'
            }
        }	
        stage('PUSH PRIVATE HARBOR') {
            steps {
                script {      
                  docker.withRegistry ('https://harbor.tkg.io', HARBOR_CREDENTIAL) {
                    dockerImage.push()
                    dockerImage.push('${BUILD_NUMBER}')
                    }
                } 
            }
        }
    }
}
